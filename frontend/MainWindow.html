<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Messenger</title>
    <link rel="stylesheet" href="Style.css" id="theme-style">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –ü–∞–Ω–µ–ª—å —Å–º–∞–π–ª–∏–∫–æ–≤ */
        #emoji-panel {
          position: absolute;
          bottom: 70px;
          right: 50px;
          background: var(--panel);
          border-radius: 10px;
          padding: 10px;
          display: none;
          flex-wrap: wrap;
          max-width: 220px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.3);
          z-index: 100;
        }
        #emoji-panel span {
          cursor: pointer;
          padding: 5px;
          font-size: 20px;
        }
        #emoji-panel span:hover {
          background: var(--accent);
          border-radius: 5px;
        }
        /* –ü—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª */
        .media-attachment {
          margin-top: 8px;
          border-radius: 12px;
          overflow: hidden;
          max-width: 250px;
        }
        .media-attachment img {
          width: 100%;
          height: auto;
          display: block;
        }
        audio {
          margin-top: 8px;
          width: 200px;
        }
        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏ */
        #recording-indicator {
          display: none;
          position: absolute;
          bottom: 80px;
          right: 60px;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          background: red;
          animation: pulse 1s infinite;
          z-index: 200;
        }
        @keyframes pulse {
          0% { transform: scale(1); opacity: 1; }
          50% { transform: scale(1.5); opacity: 0.5; }
          100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="dark">
<div class="app-container">
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="hex-nav">
        <div class="hex-button active" data-tab="chat"><i class="fas fa-comment-alt"></i></div>
        <div class="hex-button" data-tab="users"><i class="fas fa-users"></i></div>
        <div class="hex-button" data-tab="notifications"><i class="fas fa-bell"></i></div>
        <div class="hex-button" data-tab="settings"><i class="fas fa-cog"></i></div>
        <div class="hex-button" data-tab="favorites"><i class="fas fa-star"></i></div>
        <div class="hex-button" data-tab="new-chat"><i class="fas fa-plus"></i></div>
    </div>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="circle-header">
        <div class="channel-info">
            <div class="channel-icon"><i class="fas fa-hashtag"></i></div>
            <div>
                <h2 id="current-chat-name">–û–±—â–∏–π —á–∞—Ç</h2>
                <p id="current-chat-desc">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Nexus Messenger</p>
            </div>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div class="messages-container" id="messages-container"></div>

    <!-- –ü–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ -->
    <div class="wave-input">
        <div class="input-wrapper">
            <input type="text" id="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
            <div class="input-buttons">
                <button class="input-btn" id="send-button"><i class="fas fa-paper-plane"></i></button>
                <button class="input-btn" id="emoji-button"><i class="fas fa-smile"></i></button>
                <button class="input-btn" id="attach-button"><i class="fas fa-paperclip"></i></button>
                <button class="input-btn" id="mic-button"><i class="fas fa-microphone"></i></button>
                <input type="file" id="file-input" style="display:none" multiple>
            </div>
        </div>
        <div id="emoji-panel"></div>
        <div id="recording-indicator"></div>
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="diamond-sidebar">
        <div class="sidebar-content">
            <div class="tab-content" id="chat-tab">
                <div class="user-card">
                    <div class="user-avatar">–Ø</div>
                    <div class="user-name" id="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                    <div class="user-status">Online</div>
                </div>
                <div class="chat-list">
                    <h3>–ß–∞—Ç—ã</h3>
                    <div class="chat-item active" data-chat="–û–±—â–∏–π —á–∞—Ç">üí¨ –û–±—â–∏–π —á–∞—Ç</div>
                </div>
            </div>
            <div class="tab-content" id="users-tab" style="display:none;">
                <h3>–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                <p>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã–π</p>
            </div>
            <div class="tab-content" id="notifications-tab" style="display:none;">
                <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                <div class="notifications-list" id="notifications-list"><p>–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p></div>
            </div>
            <div class="tab-content" id="favorites-tab" style="display:none;">
                <h3>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h3>
                <div class="favorites-list" id="favorites-list"><p>–ü–æ–∫–∞ –ø—É—Å—Ç–æ</p></div>
            </div>
            <div class="tab-content" id="new-chat-tab" style="display:none;">
                <h3>–ù–æ–≤—ã–π —á–∞—Ç</h3>
                <button class="user-action-btn" id="create-chat-btn">–°–æ–∑–¥–∞—Ç—å —á–∞—Ç</button>
            </div>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <label>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                    <select id="theme-select">
                        <option value="dark">–¢—ë–º–Ω–∞—è</option>
                        <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
                    </select>
                </div>
                <div class="setting-item">
                    <button class="user-action-btn" id="logout-btn">–í—ã–π—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      const messagesContainer = document.getElementById("messages-container");
      const messageInput = document.getElementById("message-input");
      const sendButton = document.getElementById("send-button");
      const emojiButton = document.getElementById("emoji-button");
      const attachButton = document.getElementById("attach-button");
      const micButton = document.getElementById("mic-button");
      const fileInput = document.getElementById("file-input");
      const emojiPanel = document.getElementById("emoji-panel");
      const recordingIndicator = document.getElementById("recording-indicator");
      const favoritesList = document.getElementById("favorites-list");
      const notificationsList = document.getElementById("notifications-list");
      const themeSelect = document.getElementById("theme-select");

      let mediaRecorder;
      let audioChunks = [];

      const currentUser = localStorage.getItem("username") || "–ì–æ—Å—Ç—å";
      document.getElementById("user-name").textContent = currentUser;

      function getCurrentTime() {
        const now = new Date();
        return now.getHours().toString().padStart(2, "0") + ":" +
               now.getMinutes().toString().padStart(2, "0");
      }

      function addMessage(user, text, type, attachment=null) {
        const msg = document.createElement("div");
        msg.className = `message ${type} new`;
        let attachHtml = "";
        if (attachment) {
          if (attachment.type === "audio") {
            attachHtml = `<audio controls src="${attachment.url}"></audio>`;
          } else if (attachment.type.startsWith("image/")) {
            attachHtml = `<div class="media-attachment"><img src="${attachment.url}"></div>`;
          } else {
            attachHtml = `<div class="media-attachment"><a href="${attachment.url}" download>${attachment.name}</a></div>`;
          }
        }
        msg.innerHTML = `
          <div class="message-avatar">${user.charAt(0)}</div>
          <div class="message-content">
            <div class="message-header">
              <span class="message-author">${user}</span>
              <span class="message-time">${getCurrentTime()}</span>
            </div>
            ${text ? `<div class="message-text">${text}</div>` : ""}
            ${attachHtml}
            <div class="message-status">
              <button onclick="addToFavorites('${text}')">‚≠ê</button>
            </div>
          </div>
        `;
        messagesContainer.appendChild(msg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function sendMessage() {
        const text = messageInput.value.trim();
        if (!text) return;
        addMessage(currentUser, text, "outgoing");
        messageInput.value = "";
      }
      sendButton.addEventListener("click", sendMessage);
      messageInput.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });

      window.addToFavorites = function(text) {
        if (!text) return;
        favoritesList.innerHTML += `<div class="favorite-item">${text}</div>`;
      }

      function addNotification(text) {
        notificationsList.innerHTML = `<div class="notification-item">${text}</div>` + notificationsList.innerHTML;
      }

      const emojis = ["üòÄ","üòÇ","üòç","üòé","üò¢","üò°","üëç","üôè","üî•","üéâ"];
      emojis.forEach(e => {
        const span = document.createElement("span");
        span.textContent = e;
        span.addEventListener("click", () => {
          messageInput.value += e;
          emojiPanel.style.display = "none";
        });
        emojiPanel.appendChild(span);
      });
      emojiButton.addEventListener("click", () => {
        emojiPanel.style.display = emojiPanel.style.display === "flex" ? "none" : "flex";
        emojiPanel.style.display = "flex";
      });

      attachButton.addEventListener("click", () => fileInput.click());
      fileInput.addEventListener("change", () => {
        for (const file of fileInput.files) {
          const reader = new FileReader();
          reader.onload = e => {
            addMessage(currentUser, "–§–∞–π–ª:", "outgoing", {
              url: e.target.result,
              type: file.type,
              name: file.name
            });
          };
          reader.readAsDataURL(file);
        }
        fileInput.value = "";
      });

      // –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
      micButton.addEventListener("click", async () => {
        if (!mediaRecorder || mediaRecorder.state === "inactive") {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];
            mediaRecorder.start();
            micButton.style.background = "red";
            recordingIndicator.style.display = "block";
            mediaRecorder.addEventListener("dataavailable", e => {
              audioChunks.push(e.data);
            });
            mediaRecorder.addEventListener("stop", () => {
              const blob = new Blob(audioChunks, { type: "audio/webm" });
              const url = URL.createObjectURL(blob);
              addMessage(currentUser, "", "outgoing", { url, type: "audio" });
              micButton.style.background = "var(--primary)";
              recordingIndicator.style.display = "none";
            });
          } catch (err) {
            alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É");
            console.error(err);
          }
        } else {
          mediaRecorder.stop();
        }
      });

      function changeTheme(theme) {
        document.body.classList.remove("dark","light");
        document.body.classList.add(theme);
        localStorage.setItem("theme", theme);
      }
      themeSelect.value = localStorage.getItem("theme") || "dark";
      changeTheme(themeSelect.value);
      themeSelect.addEventListener("change", () => changeTheme(themeSelect.value));

      document.querySelectorAll(".hex-button").forEach(btn => {
        btn.addEventListener("click", function() {
          const tab = this.getAttribute("data-tab");
          if (tab === "settings") {
            document.getElementById("settings-modal").style.display = "block";
          } else {
            document.querySelectorAll(".hex-button").forEach(b => b.classList.remove("active"));
            this.classList.add("active");
            document.querySelectorAll(".tab-content").forEach(c => c.style.display = "none");
            document.getElementById(`${tab}-tab`).style.display = "block";
          }
        });
      });

      document.querySelector(".close").addEventListener("click", () => {
        document.getElementById("settings-modal").style.display = "none";
      });
      document.getElementById("logout-btn").addEventListener("click", () => {
        localStorage.removeItem("username");
        window.location.href = "login.html";
      });
      document.getElementById("create-chat-btn").addEventListener("click", () => {
        const name = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞:");
        if (name) {
          document.querySelector(".chat-list").innerHTML += `<div class="chat-item" data-chat="${name}">üí¨ ${name}</div>`;
          addNotification(`–°–æ–∑–¥–∞–Ω —á–∞—Ç: ${name}`);
        }
      });
    });
</script>
</body>
</html>
